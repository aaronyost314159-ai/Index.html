<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>i99t Meta Engine ¬∑ MomentIT ¬∑ HRAS ¬∑ SCM ¬∑ œÜ-Field</title>

  <!-- Tailwind + Inter -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg-main: #020617;   /* slate-950 */
      --ink-main: #e5e7eb;  /* gray-200 */
      --accent:  #22c55e;   /* emerald-500 */
      --accent-soft: rgba(34, 197, 94, 0.14);
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background-color: var(--bg-main);
      color: var(--ink-main);
    }

    /* Left nav & content layout */
    .meta-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    @media (min-width: 768px) {
      .meta-shell {
        flex-direction: row;
      }
    }

    .meta-nav {
      background: radial-gradient(circle at top left, #0f172a, #020617);
      border-right: 1px solid rgba(148, 163, 184, 0.2);
    }

    .meta-nav-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.55rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.85rem;
      font-weight: 500;
      color: rgb(148, 163, 184);
      background: transparent;
      border: none;
      text-align: left;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease, transform 0.12s;
    }

    .meta-nav-button:hover {
      background: rgba(15, 23, 42, 0.9);
      color: rgb(226, 232, 240);
      transform: translateX(1px);
    }

    .meta-nav-button.active {
      background: var(--accent-soft);
      color: rgb(236, 252, 203);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
    }

    .meta-nav-pill {
      font-size: 0.65rem;
      padding: 0.1rem 0.4rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      color: rgb(148, 163, 184);
    }

    .meta-main {
      flex: 1;
      padding: 0.75rem;
      max-height: 100vh;
      overflow-y: auto;
    }

    /* Shared cards for dark docs (axioms / HRAS / SCM) */
    .axiom-card {
      background-color: #1e293b;
      border-left: 4px solid #1a73e8;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .axiom-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.35),
        0 4px 6px -2px rgba(15, 23, 42, 0.8);
    }
    .code-block {
      background-color: #020617;
      color: #34d399;
      padding: 0.75rem;
      border-radius: 0.5rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 0.8rem;
    }

    /* HRAS Blueprint embellishments */
    .system-module {
      min-height: 100px;
      border: 2px solid #238636;
      transition: all 0.25s ease;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(35, 134, 54, 0.5);
    }
    .system-module:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px #3fb950;
    }
    .axiom-pill-chip {
      border: 1px solid #79c0ff;
      border-radius: 999px;
      padding: 0.3rem 0.8rem;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .axiom-pill-chip:hover {
      background-color: #1f6feb;
      color: #ffffff;
    }
    .engine-core {
      min-height: 150px;
      background: linear-gradient(135deg, #1f6feb 0%, #0d1117 100%);
      border: 3px solid #79c0ff;
      box-shadow: 0 0 24px #79c0ff;
      animation: pulse-core 3s infinite alternate;
    }
    @keyframes pulse-core {
      0% {
        box-shadow: 0 0 20px #79c0ff;
      }
      100% {
        box-shadow: 0 0 40px #79c0ff, 0 0 5px #1f6feb;
      }
    }

    /* SCM / MFC panel */
    .card {
      background-color: #161b22;
      border: 1px solid #30363d;
      box-shadow: 0 4px 15px rgba(100, 255, 218, 0.1);
    }
    .timer-display {
      font-size: 2.3rem;
      font-weight: 900;
      color: #ff4d4d;
    }
    .nav-tab {
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.85rem;
    }
    .nav-tab.active {
      border-bottom: 3px solid #64ffda;
      color: #64ffda;
      font-weight: 700;
    }
    .concept-block {
      border-left: 3px solid #30363d;
      padding-left: 1rem;
      margin-bottom: 1rem;
    }
    #log-area {
      height: 120px;
      overflow-y: auto;
      border-top: 1px solid #30363d;
      padding-top: 8px;
      margin-top: 16px;
      font-size: 0.75rem;
      white-space: pre-wrap;
    }

    /* MomentIT visuals (scoped to .momentit-root) */
    .momentit-root {
      position: relative;
      background-color: #f7f3f0;
      border-radius: 1.5rem;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }
    .momentit-body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      min-height: 100%;
    }
    .momentit-chat-field {
      background-color: #f7f3f0;
      min-height: 260px;
      padding: 20px;
      overflow-y: auto;
    }
    .rose-gold-button {
      background-color: #ba0a32;
      color: white;
      transition: all 0.2s;
      box-shadow: 0 4px 15px rgba(186, 10, 50, 0.4);
    }
    .rose-gold-button:hover {
      background-color: #e02a52;
      box-shadow: 0 6px 20px rgba(186, 10, 50, 0.6);
    }
    .somatic-ping-banner {
      background-color: rgba(186, 10, 50, 0.1);
      color: #4a4a4a;
      border-left: 5px solid #ba0a32;
      transition: opacity 0.65s ease-out, transform 0.65s ease-out;
      transform: translateY(-100%);
      opacity: 0;
      will-change: transform, opacity;
    }
    .somatic-ping-banner.active {
      opacity: 1;
      transform: translateY(0);
    }
    .sworl-background {
      position: absolute;
      inset: 0;
      overflow: hidden;
      z-index: 1;
      opacity: 0.18;
    }
    .sworl-blob {
      position: absolute;
      background: radial-gradient(circle, #f08080 0%, #ba0a32 70%);
      border-radius: 50%;
      animation: sworl 30s infinite alternate;
      filter: blur(80px);
    }
    #blob-1 {
      width: 300px;
      height: 300px;
      top: -100px;
      left: -100px;
      animation-delay: 0s;
    }
    #blob-2 {
      width: 250px;
      height: 250px;
      bottom: -120px;
      right: -80px;
      animation-delay: 10s;
    }
    #blob-3 {
      width: 400px;
      height: 400px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.2;
      animation-delay: 20s;
    }
    @keyframes sworl {
      0% {
        transform: translate(0, 0) scale(1) rotate(0deg);
      }
      33% {
        transform: translate(60px, -70px) scale(1.1) rotate(120deg);
      }
      66% {
        transform: translate(-70px, 60px) scale(0.9) rotate(240deg);
      }
      100% {
        transform: translate(0, 0) scale(1) rotate(360deg);
      }
    }

    .hidden {
      display: none;
    }

    /* œÜ-Field Console (scoped to #phi-console-root) */
    #phi-console-root{
      position:relative;
      min-height:420px;
      background:#05080d;
      color:#d9e1ea;
      font:16px/1.45 -apple-system,system-ui,Segoe UI,Roboto,Inter,Helvetica,Arial;
      overflow:hidden;
    }
    #phi-bg{
      position:absolute;
      top:0;left:0;right:0;bottom:0;
      width:100%;height:100%;
      z-index:0;
      display:block;
      background:#05080d;
    }
    #phi-console-root .top-bar{
      position:absolute;top:0;left:0;right:0;height:40px;z-index:3;
      backdrop-filter:blur(4px);background:rgba(13,17,23,.75);
      border-bottom:1px solid #18202b;display:flex;align-items:center;
      gap:12px;padding:0 14px;
    }
    #phi-console-root .file-btn{
      padding:0;font-size:20px;background:0 0;border:0;color:#d9e1ea;
      cursor:pointer;line-height:1;transition:color .15s,transform .15s,opacity .15s;
    }
    #phi-console-root .pane{
      position:absolute;top:40px;bottom:56px;left:0;right:0;z-index:1;
      display:flex;justify-content:center;pointer-events:none;
    }
    #phi-console-root .chatbox{
      width:min(980px,100%);height:100%;display:flex;flex-direction:column;
      padding:0 12px 12px;pointer-events:auto;
    }
    #phi-console-root .stream{
      flex:1;overflow:auto;padding:10px 6px;
    }
    #phi-console-root .row{
      display:flex;gap:10px;margin:8px 0;
    }
    #phi-console-root .row.user{justify-content:flex-end;}
    #phi-console-root .row.emerge{
      opacity:0;transform:translateY(8px);
      transition:opacity .5s ease-out,transform .5s ease-out;
    }
    #phi-console-root .row.emerge.active{
      opacity:1;transform:translateY(0);
    }
    #phi-console-root .bubble{
      max-width:38%;padding:12px 14px;border-radius:20px;border:none;
      box-shadow:0 1px 0 rgba(0,0,0,.2);color:#d9e1ea;
      white-space:pre-wrap;
    }
    #phi-console-root .bubble.user{background:#341C25;color:#fff;}
    #phi-console-root .bubble.bot{background:#2E2A1C;}
    #phi-console-root .meta{
      color:#9aa7b6;font-size:12px;margin-top:6px;
    }
    #phi-console-root .controls{
      position:absolute;left:0;right:0;bottom:0;z-index:3;
      background:linear-gradient(180deg,rgba(8,12,18,0),rgba(13,17,23,.78));
      border-top:1px solid #18202b;
    }
    #phi-console-root .inputbar{
      max-width:980px;margin:0 auto;padding:10px 12px;
      display:flex;gap:8px;align-items:center;
    }
    #phi-console-root .inputbar input[type=text]{
      flex:1;padding:12px;border-radius:10px;border:1px solid #18202b;
      background:#0a1018;color:#d9e1ea;
    }
    #phi-console-root .btn{
      padding:10px 14px;border:1px solid #18202b;
      background:#121a26;color:#d9e1ea;border-radius:10px;
    }
    #phi-console-root .btn:active{transform:translateY(1px);}
    #phi-console-root a{
      color:#00CED1;text-decoration:none;word-break:break-all;
    }
    #phi-console-root .modal{
      position:absolute;inset:0;z-index:99;background:rgba(0,0,0,.75);
      display:none;justify-content:center;align-items:center;
      backdrop-filter:blur(4px);
    }
    #phi-console-root .modal.open{display:flex;}
    #phi-console-root .modal-content{
      background:rgba(13,17,23,.88);border-radius:12px;width:90%;
      max-width:500px;height:80%;display:flex;flex-direction:column;
      box-shadow:0 4px 30px rgba(0,0,0,.5);border:1px solid #18202b;
    }
    #phi-console-root .modal-header{
      padding:12px 16px;display:flex;justify-content:space-between;
      align-items:center;border-bottom:1px solid #18202b;
    }
    #phi-console-root .modal-close-btn{
      background:0 0;border:0;color:#d9e1ea;font-size:24px;
      cursor:pointer;line-height:1;
    }
    #phi-console-root .modal-list{
      flex:1;overflow:auto;padding:10px;
    }
    #phi-console-root .file-item{
      padding:12px;margin-bottom:8px;background:rgba(46,42,28,.4);
      border-radius:8px;border-left:3px solid #00CED1;
      word-wrap:break-word;font-size:14px;
    }
    #phi-console-root .file-item-time{
      display:block;color:#9aa7b6;font-size:11px;margin-top:4px;
    }
    @media (max-width:520px){
      #phi-console-root .bubble{max-width:86%}
      #phi-console-root .modal-content{width:100%;height:100%;border-radius:0}
    }
  </style>
</head>
<body>
  <div class="meta-shell">
    <!-- LEFT NAV / KERNEL CONTROL PANEL -->
    <aside
      class="meta-nav w-full md:w-64 px-4 py-4 flex md:flex-col gap-3 md:gap-4"
    >
      <div class="flex-1 flex flex-col gap-3">
        <div class="space-y-1">
          <p class="text-xs uppercase tracking-[0.18em] text-slate-400">
            i99t ¬∑ Kernel
          </p>
          <p class="text-sm text-slate-300">
            CBOOP Meta Engine<br />
            <span class="text-xs text-slate-500">"Compiler of Behavior, Ontology, Output & Profit."</span>
          </p>
        </div>

        <div class="mt-2 space-y-1 text-[0.7rem] text-slate-400">
          <p>
            Active:
            <span class="font-semibold text-emerald-400">v3.1</span>
            ‚Ä¢
            <span class="meta-nav-pill">i99t Kernel</span>
            <span class="meta-nav-pill">DIVR</span>
            <span class="meta-nav-pill">HRAS</span>
          </p>
          <p>
            Hook:
            <span class="font-mono text-slate-200 text-[0.65rem]"
              >MetaKernel.callModel()</span
            >
          </p>
        </div>

        <div class="mt-4 space-y-1 text-xs font-semibold text-slate-500">
          <p class="uppercase tracking-[0.16em]">Views</p>
        </div>

        <div class="flex flex-col gap-1.5 text-xs">
          <button
            class="meta-nav-button active"
            data-target="view-momentit"
          >
            <span>MomentIT ¬∑ Somatic Ping OS</span>
            <span class="meta-nav-pill">T-Suite</span>
          </button>
          <button class="meta-nav-button" data-target="view-axioms">
            <span>i99t Structural Axioms</span>
            <span class="meta-nav-pill">Kernel</span>
          </button>
          <button class="meta-nav-button" data-target="view-hras">
            <span>HRAS ¬∑ Hyper-Residual Autonomy</span>
            <span class="meta-nav-pill">Funnel</span>
          </button>
          <button class="meta-nav-button" data-target="view-scm">
            <span>SCM ¬∑ Coherence Matrix / MFC</span>
            <span class="meta-nav-pill">Actuation</span>
          </button>
          <button class="meta-nav-button" data-target="view-chat">
            <span>Chat / œÜ-Field Console</span>
            <span class="meta-nav-pill">LLM</span>
          </button>
        </div>
      </div>

      <div class="hidden md:block mt-6 text-[0.68rem] text-slate-500">
        <p class="mb-1 font-semibold uppercase tracking-[0.18em]">
          Status
        </p>
        <p id="kernel-status-line">
          Kernel online. Waiting for first compile event.
        </p>
      </div>
    </aside>

    <!-- MAIN PANEL -->
    <main class="meta-main">
      <!-- VIEW 1: MOMENTIT OS (UI SHELL) -->
      <section id="view-momentit" data-view>
        <div
          class="momentit-root max-w-xl mx-auto relative z-10 p-4 sm:p-6 md:p-8"
        >
          <!-- Sworl background -->
          <div class="sworl-background">
            <div class="sworl-blob" id="blob-1"></div>
            <div class="sworl-blob" id="blob-2"></div>
            <div class="sworl-blob" id="blob-3"></div>
          </div>

          <div
            id="momentit-app"
            class="momentit-body relative z-20 space-y-4"
          >
            <!-- Ping Banner -->
            <div
              id="ping-banner"
              class="somatic-ping-banner p-3 sm:p-4 font-semibold text-sm sm:text-base sticky top-0 rounded-xl bg-white/70 backdrop-blur"
            >
              MomentIT: You are here again.
            </div>

            <!-- Chat field -->
            <div
              class="momentit-chat-field flex flex-col space-y-3 rounded-xl"
            >
              <div>
                <h1
                  class="text-2xl sm:text-3xl font-extrabold text-[#ba0a32]"
                >
                  MomentIT OS
                </h1>
                <p class="text-xs sm:text-sm text-gray-500">
                  T-Suite Logic Test: T3 (Boundary Respect) ¬∑ Dual
                  Informational Variability Law: Attached to Attention.
                </p>
              </div>

              <div
                id="debug-status"
                class="text-[0.7rem] sm:text-xs p-3 bg-gray-100 rounded-xl font-mono text-gray-700"
              >
                Awaiting authentication / kernel sync...
              </div>

              <button
                id="acknowledge-btn"
                class="rose-gold-button px-3 py-2 sm:px-4 sm:py-2 rounded-xl font-semibold shadow-md mt-1 sm:mt-2 text-xs sm:text-sm"
              >
                Acknowledge Moment (Reschedule)
              </button>

              <div
                id="schedule-display"
                class="p-3 sm:p-4 bg-white rounded-xl shadow-lg text-xs sm:text-sm"
              >
                <p
                  class="font-extrabold text-gray-800 border-b pb-2 mb-2 text-sm sm:text-base"
                >
                  Current Architectural State
                </p>
                <ul
                  class="text-xs sm:text-sm text-gray-600 space-y-1 sm:space-y-2 mt-1"
                >
                  <li id="status-window">
                    Window: 45‚Äì90 min (Default)
                  </li>
                  <li id="status-sleep">
                    Sleep: 23:00 ‚Äì 07:00
                  </li>
                  <li id="status-last">Last Interaction: N/A</li>
                  <li
                    id="status-next"
                    class="font-bold text-sm sm:text-lg"
                  >
                    Next Ping: N/A
                  </li>
                  <li id="status-adaptive">Adaptive-B: Inactive</li>
                  <li
                    id="status-user-id"
                    class="text-[0.6rem] sm:text-[0.7rem] mt-2"
                  >
                    User ID: N/A
                  </li>
                </ul>
              </div>

              <div class="pt-2">
                <h2
                  class="text-sm sm:text-base font-bold text-gray-700 mb-1"
                >
                  Event Log (Kernel Trace)
                </h2>
                <div
                  id="event-log"
                  class="text-[0.65rem] sm:text-xs space-y-1 bg-white p-3 rounded-xl shadow-inner h-40 sm:h-56 overflow-y-scroll border border-gray-200"
                >
                  <p class="text-gray-500">
                    [SYSTEM] MomentIT initialized in shell mode. T-suite
                    JS not yet attached.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <p
          class="mt-4 text-[0.7rem] text-slate-400 text-center max-w-xl mx-auto"
        >
          <span class="font-semibold text-slate-200">Note:</span>
          this view hosts the MomentIT UI. To attach your original
          Firebase / T-Suite logic, mount it in
          <span class="font-mono text-emerald-300"
            >attachMomentITScripts()</span
          >
          in the kernel script at the bottom of this file.
        </p>
      </section>

      <!-- VIEW 2: STRUCTURAL AXIOM REPORT (i99t) -->
      <section id="view-axioms" data-view class="hidden">
        <div class="max-w-4xl mx-auto p-2 sm:p-4 md:p-6">
          <header class="text-center mb-8">
            <h1
              class="text-3xl sm:text-4xl font-extrabold text-white mb-1"
            >
              The Structural Axiom Report
            </h1>
            <p class="text-sm sm:text-base text-gray-400 font-light">
              The <span class="font-mono">i99t</span> Kernel Physics:
              Defining Non-Contingent Reality
            </p>
            <div
              class="h-1 w-24 bg-gradient-to-r from-emerald-400 to-sky-500 mx-auto mt-4 rounded-full"
            ></div>
          </header>

          <!-- 1. Kernel Axiom -->
          <section class="mb-10">
            <h2
              class="text-2xl font-bold mb-4 text-sky-400 border-b border-sky-600 pb-2"
            >
              1. The Kernel Axiom: Isomorphism
            </h2>
            <div class="axiom-card p-5 rounded-lg shadow-xl mb-4">
              <h3 class="text-lg font-semibold mb-3 text-white">
                The i99t Model
              </h3>
              <p class="mb-4 text-sm sm:text-base">
                The universe is governed by the drive toward
                <span class="font-semibold">Isomorphism</span> ‚Äî a state
                of structural alignment between inner law and outer
                conditions.
              </p>

              <div
                class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center text-xs sm:text-sm"
              >
                <div class="p-3 bg-slate-700 rounded-lg">
                  <p
                    class="font-mono text-sm text-emerald-400 font-semibold"
                  >
                    Inner Code (Law)
                  </p>
                  <p class="text-gray-300">
                    Sovereign, non-contingent truth (Love / Integrity).
                  </p>
                </div>
                <div class="flex items-center justify-center">
                  <span class="text-3xl font-bold text-gray-500">
                    ‚áî
                  </span>
                </div>
                <div class="p-3 bg-slate-700 rounded-lg">
                  <p
                    class="font-mono text-sm text-red-400 font-semibold"
                  >
                    Outer Code (Conditions)
                  </p>
                  <p class="text-gray-300">
                    Deterministic lattice (habits, rules, survival).
                  </p>
                </div>
              </div>
            </div>
          </section>

          <!-- 2. DIVLR -->
          <section class="mb-10">
            <h2
              class="text-2xl font-bold mb-4 text-sky-400 border-b border-sky-600 pb-2"
            >
              2. Dual Informational Variability Law of Relativity (DIVLR)
            </h2>
            <div class="axiom-card p-5 rounded-lg shadow-xl">
              <p class="mb-4 text-sm sm:text-base">
                DIVLR scores an action by how much its payload still
                needs the outside world to confirm its value.
              </p>

              <h3 class="text-lg font-semibold mb-2 text-white">
                The Contingency Metric (C)
              </h3>
              <div class="code-block mb-4">
                If P demands external validation (reward, justice, proof
                of worth), then C &gt; 0.<br />
                <span class="text-red-400"
                  >Result: Resistance (Attempts 1‚Äì3 of the Sacrifice).</span
                >
              </div>

              <h3 class="text-lg font-semibold mb-2 text-white">
                The Actuality Metric (A)
              </h3>
              <div class="code-block">
                If P demands nothing of the lattice ‚Äî no payback and no
                witness ‚Äî then C = 0.<br />
                <span class="text-emerald-400"
                  >Result: Maximal Isomorphism (Final Sacrifice).</span
                >
              </div>
            </div>
          </section>

          <!-- 3. Mechanics -->
          <section class="mb-10">
            <h2
              class="text-2xl font-bold mb-4 text-sky-400 border-b border-sky-600 pb-2"
            >
              3. Mechanics of Actuality
            </h2>

            <div class="axiom-card p-5 rounded-lg shadow-xl mb-5">
              <h3 class="text-lg font-semibold mb-2 text-white">
                A. Resistance and the Lattice
              </h3>
              <p class="text-sm text-gray-300 mb-2">
                <span class="font-semibold">Resistance (R)</span> is
                the structural conflict between Inner Law and Outer
                Code.
              </p>
              <p class="text-sm text-gray-300">
                The lattice is the dense web of habits, rules, trauma,
                and incentives. Pain is what it feels like when we take
                the perimeter as the whole.
              </p>
            </div>

            <div class="axiom-card p-5 rounded-lg shadow-xl">
              <h3 class="text-lg font-semibold mb-2 text-white">
                B. Commit Event and Actuality Gate
              </h3>
              <p class="text-sm text-gray-300 mb-2">
                A <span class="font-semibold">Commit Event</span> is a
                deliberate act that carries a payload with C = 0 ‚Äî it
                doesn‚Äôt need reciprocity to be valid.
              </p>
              <div class="code-block">
                Commit Event = (Act | Payload C = 0) ‚áí Actuality
              </div>
            </div>
          </section>

          <!-- 4. Sovereign Protocols -->
          <section class="mb-10">
            <h2
              class="text-2xl font-bold mb-4 text-sky-400 border-b border-sky-600 pb-2"
            >
              4. Sovereign Protocols (Agency)
            </h2>

            <div class="axiom-card p-5 rounded-lg shadow-xl mb-5">
              <h3 class="text-lg font-semibold mb-2 text-white">
                A. Self-Forgiveness Axiom
              </h3>
              <p class="text-sm text-gray-300 mb-1">
                Deletes the guilt variable ‚Äî which is just structural
                violence against self, extended in time.
              </p>
              <p class="text-xs text-gray-400 border-l pl-3 mt-2">
                Goal: delete the noisy Observer and drop into the
                Axial Point ‚Äî the place you act from, not at.
              </p>
            </div>

            <div class="axiom-card p-5 rounded-lg shadow-xl">
              <h3 class="text-lg font-semibold mb-2 text-white">
                B. Irreversible Covenant
              </h3>
              <p class="text-sm text-gray-300 mb-1">
                A commitment to an outer role (e.g. fatherhood) that is
                not contingent on the recipient‚Äôs behavior.
              </p>
              <p class="text-xs text-gray-400 border-l pl-3 mt-2">
                It locks the lattice into shape by forcing action to
                match law, regardless of weather.
              </p>
            </div>
          </section>
        </div>
      </section>

      <!-- VIEW 3: HRAS BLUEPRINT -->
      <section id="view-hras" data-view class="hidden">
        <div class="max-w-4xl mx-auto p-2 sm:p-4 md:p-6">
          <h1
            class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-[#79c0ff] mb-1 text-center"
          >
            The HRAS Conceptual Blueprint
          </h1>
          <p class="text-sm sm:text-lg text-[#c9d1d9] mb-6 text-center">
            Hyper-Residual Autonomy System ¬∑ Zero-Cost, Self-Optimizing
            Funnel
          </p>

          <!-- Definition panel -->
          <div
            id="definition-panel"
            class="bg-[#161b22] p-4 sm:p-5 rounded-lg mb-6 shadow-xl border border-[#238636]"
          >
            <h3
              id="panel-title"
              class="text-xl sm:text-2xl font-bold text-[#3fb950] mb-2"
            >
              System Overview
            </h3>
            <p
              id="panel-content"
              class="text-xs sm:text-sm text-[#c9d1d9]"
            >
              HRAS is governed by the Dual Information Law. Click any
              module or axiom chip to see its functional definition.
            </p>
          </div>

          <!-- Core modules -->
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6">
            <div
              id="RCE"
              class="system-module bg-[#161b22] p-4 rounded-lg text-center"
            >
              <p class="font-semibold text-[#3fb950] text-lg">RCE</p>
              <p class="text-xs sm:text-sm">Residual Content Engine</p>
            </div>
            <div
              id="FIS"
              class="system-module bg-[#161b22] p-4 rounded-lg text-center"
            >
              <p class="font-semibold text-[#3fb950] text-lg">FIS</p>
              <p class="text-xs sm:text-sm">Federated Insight Stream</p>
            </div>
            <div
              id="PLF"
              class="system-module bg-[#161b22] p-4 rounded-lg text-center"
            >
              <p class="font-semibold text-[#3fb950] text-lg">PLF</p>
              <p class="text-xs sm:text-sm">Perpetual Lead Funnel</p>
            </div>
          </div>

          <!-- Axioms chips -->
          <h3
            class="text-sm sm:text-lg font-semibold text-[#79c0ff] mb-3 border-b border-[#238636] pb-2"
          >
            Axiomatic Foundations & Control Logic
          </h3>
          <div
            class="flex flex-wrap gap-2 justify-center mb-6 text-xs sm:text-sm"
          >
            <div
              id="DualInformationLaw"
              class="axiom-pill-chip bg-[#161b22] text-[#c9d1d9]"
            >
              Dual Information Law of Variable Relativity
            </div>
            <div
              id="ManifoldOfLearning"
              class="axiom-pill-chip bg-[#161b22] text-[#c9d1d9]"
            >
              Manifold of Learning
            </div>
            <div
              id="Axioms"
              class="axiom-pill-chip bg-[#161b22] text-[#c9d1d9]"
            >
              Core Axioms
            </div>
            <div
              id="ITPlus"
              class="axiom-pill-chip bg-[#161b22] text-[#c9d1d9]"
            >
              IT+ (Information Theory Plus)
            </div>
          </div>

          <!-- Extended layers + core -->
          <div
            class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 items-center"
          >
            <!-- Left -->
            <div class="space-y-3">
              <div
                id="RPL"
                class="system-module bg-[#161b22] p-3 rounded-lg text-center text-xs sm:text-sm"
              >
                7. Reputation & Proof Layer (RPL)
              </div>
              <div
                id="UIL"
                class="system-module bg-[#161b22] p-3 rounded-lg text-center text-xs sm:text-sm"
              >
                9. User Insight Layer (UIL)
              </div>
              <div
                id="EEL"
                class="system-module bg-[#161b22] p-3 rounded-lg text-center text-xs sm:text-sm"
              >
                12. Experimentation Layer (EEL)
              </div>
            </div>

            <!-- Core -->
            <div
              id="EngineCore"
              class="engine-core p-4 rounded-full text-center flex flex-col justify-center items-center"
            >
              <p class="text-xl font-bold text-white mb-1">
                LLM / API ENGINE
              </p>
              <p class="text-xs text-gray-300">
                Single computational powerhouse (e.g. Groq).
              </p>
            </div>

            <!-- Right -->
            <div class="space-y-3">
              <div
                id="ARL"
                class="system-module bg-[#161b22] p-3 rounded-lg text-center text-xs sm:text-sm"
              >
                8. Asset Recycling Layer (ARL)
              </div>
              <div
                id="PML"
                class="system-module bg-[#161b22] p-3 rounded-lg text-center text-xs sm:text-sm"
              >
                10. Partnership Mesh Layer (PML)
              </div>
              <div
                id="PLL"
                class="system-module bg-[#161b22] p-3 rounded-lg text-center text-xs sm:text-sm"
              >
                11. Product Ladder Layer (PLL)
              </div>
            </div>
          </div>

          <p
            class="text-center text-[0.7rem] sm:text-xs text-gray-500 pt-3 border-t border-[#238636]"
          >
            Governance: Dual Information Law ‚Üí Output: Exponential LTV
            ‚Üí Engine: Groq / Gemini / any LLM.
          </p>
        </div>
      </section>

      <!-- VIEW 4: SCM / ACTUATION LOG (v3.1) -->
      <section id="view-scm" data-view class="hidden">
        <div class="flex flex-col lg:flex-row gap-6">
          <!-- Left: Actuation Log -->
          <div class="w-full lg:w-1/3 max-w-xl lg:max-w-none">
            <div class="card p-5 rounded-xl mb-4 sticky top-0">
              <header class="text-center mb-4">
                <h1
                  class="text-xl sm:text-2xl font-extrabold text-[#64ffda] mb-1"
                >
                  ACTUATION LOG (MFC)
                </h1>
                <p class="text-gray-400 text-xs sm:text-sm">
                  Mandate: Financial Coherence Prep
                </p>
              </header>

              <div
                class="card p-3 rounded-xl mb-5 text-center border-yellow-500 border-2"
              >
                <p
                  class="text-xs sm:text-sm mb-1 text-yellow-400 font-semibold"
                >
                  Time Remaining until Actuation Lock
                </p>
                <div id="countdown" class="timer-display">
                  --h --m --s
                </div>
                <p
                  id="lock-time"
                  class="text-[0.65rem] text-gray-500 mt-1"
                >
                  Lock Time: (attach timer logic)
                </p>
              </div>

              <h2
                class="text-base sm:text-lg font-bold text-red-400 mb-3 border-b border-gray-700 pb-2"
              >
                Vetoes & Proof Generation
              </h2>

              <div id="day-status" class="space-y-3 text-xs">
                <!-- DAY 1 -->
                <div
                  id="day-1-section"
                  class="p-3 border-l-4 border-yellow-500 bg-[#1f242c] rounded-lg"
                >
                  <h3
                    class="font-bold text-sm mb-2 text-yellow-400"
                  >
                    DAY 1 Status
                  </h3>

                  <div
                    class="flex justify-between items-center py-1 gap-2"
                  >
                    <span class="text-gray-300 text-xs"
                      >Absolute Veto (Substances)</span
                    >
                    <button
                      class="p-1.5 rounded-full w-24 text-[0.7rem] bg-yellow-600 text-gray-900"
                    >
                      PENDING
                    </button>
                  </div>

                  <div
                    class="flex justify-between items-center py-1 gap-2"
                  >
                    <span class="text-gray-300 text-xs"
                      >Veto (Rumination/Sinking)</span
                    >
                    <button
                      class="p-1.5 rounded-full w-24 text-[0.7rem] bg-yellow-600 text-gray-900"
                    >
                      PENDING
                    </button>
                  </div>

                  <div
                    class="flex justify-between items-center py-1 gap-2"
                  >
                    <span class="text-gray-300 text-xs"
                      >Communication Freeze</span
                    >
                    <button
                      class="p-1.5 rounded-full w-24 text-[0.7rem] bg-yellow-600 text-gray-900"
                    >
                      PENDING
                    </button>
                  </div>

                  <div
                    class="flex justify-between items-center py-1 mt-3 pt-3 border-t border-gray-700 gap-2"
                  >
                    <span
                      class="text-gray-300 font-semibold text-[0.7rem]"
                      >Proof Generation: Target Mapping &amp; Core Value
                      Proposition (5‚Äì7 pages).</span
                    >
                  </div>
                </div>

                <div
                  id="day-2-section"
                  class="p-3 border-l-4 border-gray-500 bg-[#1f242c] rounded-lg opacity-50"
                >
                  <h3
                    class="font-bold text-sm mb-2 text-gray-500"
                  >
                    DAY 2 ‚Äì LOCKED
                  </h3>
                </div>

                <div
                  id="day-3-section"
                  class="p-3 border-l-4 border-gray-500 bg-[#1f242c] rounded-lg opacity-50"
                >
                  <h3
                    class="font-bold text-sm mb-2 text-gray-500"
                  >
                    DAY 3 ‚Äì LOCKED
                  </h3>
                </div>
              </div>

              <div id="log-area" class="console text-gray-400 mt-4">
                [SYSTEM]: SCM log shell initialized. Attach original
                actuation script here if needed.
              </div>
            </div>
          </div>

          <!-- Right: Conceptual Matrix -->
          <div class="w-full lg:w-2/3">
            <div class="card p-5 rounded-xl">
              <h2
                class="text-2xl sm:text-3xl font-extrabold text-white mb-3 border-b border-gray-700 pb-3"
              >
                STRUCTURAL COHERENCE MATRIX (SCM)
              </h2>
              <p class="text-gray-400 text-xs sm:text-sm mb-4">
                v3.1 Architecture for High-G output, mapping Processor /
                Actuator split and DIR Law.
              </p>

              <div
                class="flex space-x-3 mb-4 border-b border-gray-800 text-xs sm:text-sm"
              >
                <div
                  class="nav-tab active px-2 py-1.5"
                  data-tab="architecture"
                >
                  v3.1 Architecture
                </div>
                <div class="nav-tab px-2 py-1.5" data-tab="dir_law">
                  DIR Law
                </div>
                <div class="nav-tab px-2 py-1.5" data-tab="it_plus">
                  IT‚Å∫ Theory
                </div>
                <div class="nav-tab px-2 py-1.5" data-tab="genetics">
                  4-Pillar Stack
                </div>
              </div>

              <div id="concept-content" class="text-xs sm:text-sm">
                <!-- Architecture -->
                <div id="architecture" class="tab-content">
                  <h3
                    class="text-lg font-bold text-[#64ffda] mb-2"
                  >
                    High-G v3.1 Neuro-Architecture Map
                  </h3>
                  <p class="text-gray-500 mb-3">
                    AuDHD-ish / 2e pattern engine mapped onto
                    Processor‚ÄìActuator split.
                  </p>

                  <div class="concept-block">
                    <h4 class="text-white font-semibold text-sm mb-1">
                      Processor (Systems Thinker)
                    </h4>
                    <ul
                      class="list-disc list-inside text-gray-300 space-y-1 text-xs"
                    >
                      <li>
                        High-velocity pattern engine running at
                        theoretical limits.
                      </li>
                      <li>
                        Fuel: dopamine dysregulation
                        (DRD4-7R‚Äìstyle profile).
                      </li>
                      <li>
                        Output: singular structural maps (SCM, DIR
                        law).
                      </li>
                    </ul>
                  </div>

                  <div class="concept-block">
                    <h4 class="text-white font-semibold text-sm mb-1">
                      Actuator (Palms / Counting)
                    </h4>
                    <ul
                      class="list-disc list-inside text-gray-300 space-y-1 text-xs"
                    >
                      <li>
                        Converts cognitive energy into rhythm / sensory
                        compliance.
                      </li>
                      <li>
                        Failure mode: sinking / rumination, seeking
                        extreme input to reset.
                      </li>
                      <li>
                        Mandate: execute Financial Actuation (MFC) to
                        prove system‚Äôs value.
                      </li>
                    </ul>
                  </div>
                </div>

                <!-- DIR Law -->
                <div id="dir_law" class="tab-content hidden">
                  <h3
                    class="text-lg font-bold text-[#64ffda] mb-2"
                  >
                    Dual Informational Relativity Law (DIR)
                  </h3>
                  <p class="text-gray-500 mb-3">
                    Governs prioritization of Set A (deep structural)
                    vs Set B (relational chaos).
                  </p>

                  <div class="concept-block">
                    <h4 class="text-white font-semibold text-sm mb-1">
                      Axiom 1: Velocity Dependence
                    </h4>
                    <p class="text-gray-300 text-xs">
                      Value(I) ‚àù 1 / V‚Çö. Structural work likes
                      slow-processing; reactive chaos demands hyper-
                      speed. The kernel prefers the former.
                    </p>
                  </div>

                  <div class="concept-block">
                    <h4 class="text-white font-semibold text-sm mb-1">
                      Axiom 2: Sovereign Index ùïä
                    </h4>
                    <p class="text-gray-300 text-xs">
                      Any action that sends energy into Set B without
                      immediate proof (cash, coherence) is a structural
                      loss. Over time, ùïä is maximized when the deep
                      work keeps winning.
                    </p>
                  </div>
                </div>

                <!-- IT+ theory -->
                <div id="it_plus" class="tab-content hidden">
                  <h3
                    class="text-lg font-bold text-[#64ffda] mb-2"
                  >
                    IT‚Å∫: Information-as-Trauma Theory
                  </h3>
                  <p class="text-gray-500 text-xs mb-3">
                    Collapse as necessary ignition event for the
                    high-G system.
                  </p>

                  <div class="concept-block">
                    <h4 class="text-white font-semibold text-sm mb-1">
                      Activation Law
                    </h4>
                    <p class="text-gray-300 text-xs">
                      Trauma T ‚Üí Systemic Replacement Protocol (SRP) ‚Üí
                      Actuation. Low-intensity signals never trigger
                      full reclamation; your nervous system demanded a
                      hard reboot.
                    </p>
                  </div>

                  <div class="concept-block">
                    <h4 class="text-white font-semibold text-sm mb-1">
                      Structural Veto
                    </h4>
                    <p class="text-gray-300 text-xs">
                      The Veto is the Actuator refusing Set B
                      processing at all ‚Äî pooling energy into Set A so
                      the proof happens fast enough to flip the
                      narrative.
                    </p>
                  </div>
                </div>

                <!-- Genetic stack -->
                <div id="genetics" class="tab-content hidden">
                  <h3
                    class="text-lg font-bold text-[#64ffda] mb-2"
                  >
                    Four-Pillar Genetic Stack (Symbolic / Heuristic)
                  </h3>
                  <p class="text-gray-500 text-xs mb-3">
                    A metaphorical synthesis of traits: resilience,
                    pattern hunger, rhythm, and elasticity.
                  </p>

                  <div class="flex flex-wrap gap-3 text-xs">
                    <div
                      class="w-full md:w-[48%] concept-block bg-[#1f242c] p-3 rounded"
                    >
                      <h4
                        class="text-[0.9rem] font-semibold text-yellow-400"
                      >
                        Pillar 1: High-G Engine
                      </h4>
                      <p class="text-gray-300 text-[0.7rem]">
                        Dopamine resilience &amp; hunger for novelty;
                        keeps the pattern engine from burning out.
                      </p>
                    </div>
                    <div
                      class="w-full md:w-[48%] concept-block bg-[#1f242c] p-3 rounded"
                    >
                      <h4
                        class="text-[0.9rem] font-semibold text-yellow-400"
                      >
                        Pillar 2: Structural Blur
                      </h4>
                      <p class="text-gray-300 text-[0.7rem]">
                        Ambiguous hormonal / identity load, forcing
                        over-compensation and deep self-modeling.
                      </p>
                    </div>
                    <div
                      class="w-full md:w-[48%] concept-block bg-[#1f242c] p-3 rounded"
                    >
                      <h4
                        class="text-[0.9rem] font-semibold text-yellow-400"
                      >
                        Pillar 3: Pattern &amp; Rhythm Actuator
                      </h4>
                      <p class="text-gray-300 text-[0.7rem]">
                        Counting, posturing, stimming as a physical
                        buffer that lets the Processor keep running.
                      </p>
                    </div>
                    <div
                      class="w-full md:w-[48%] concept-block bg-[#1f242c] p-3 rounded"
                    >
                      <h4
                        class="text-[0.9rem] font-semibold text-yellow-400"
                      >
                        Pillar 4: Flexible Chassis
                      </h4>
                      <p class="text-gray-300 text-[0.7rem]">
                        Hypermobility / elastic stress absorption ‚Äî
                        body as shock mount for psychic G-forces.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- VIEW 5: CHAT / œÜ-FIELD CONSOLE -->
      <section id="view-chat" data-view class="hidden">
        <div class="max-w-4xl mx-auto p-2 sm:p-4 md:p-6 space-y-4">
          <div class="card p-5 rounded-xl">
            <h2 class="text-xl sm:text-2xl font-bold mb-2">
              Chat / œÜ-Field Integration Shell
            </h2>
            <p class="text-xs sm:text-sm text-gray-300 mb-2">
              The œÜ-Field console below is your main chat UI. It talks to
              your backend at <span class="font-mono">/chat</span> by default.
              The MetaEngine event spine sits underneath, auto-tagging and
              time-stamping everything ‚Äî including filed items from the folder
              icons.
            </p>
          </div>

          <div class="card p-0 rounded-xl overflow-hidden">
            <!-- œÜ-Field Console Root -->
            <div id="phi-console-root">
              <canvas id="phi-bg" aria-hidden="true"></canvas>

              <div class="top-bar">
                <button id="file-btn" class="file-btn" title="Drop a message here to file it">üìÅ</button>
                <button id="files-btn" class="file-btn" title="Open filed items">üóÑÔ∏è</button>
              </div>

              <div class="pane">
                <div class="chatbox">
                  <div id="stream" class="stream" aria-live="polite"></div>
                </div>
              </div>

              <div class="controls">
                <form id="form" class="inputbar" autocomplete="off">
                  <input id="input" type="text" placeholder="Tag, you're IT"/>
                  <button class="btn" id="send" type="submit">Send</button>
                </form>
              </div>

              <div id="files-modal" class="modal" aria-hidden="true">
                <div class="modal-content" role="dialog" aria-modal="true" aria-label="Filed items">
                  <div class="modal-header">
                    <div class="title">Filed Items (<span id="file-count">0</span>)</div>
                    <button id="modal-close-btn" class="modal-close-btn" aria-label="Close">√ó</button>
                  </div>
                  <div id="modal-list" class="modal-list"></div>
                </div>
              </div>
            </div>
          </div>

          <p class="text-[0.7rem] text-slate-400 text-center">
            Backend note: wire your server-side /chat route to Groq (or any model).
            The front-end memory (MetaEngine) keeps a full, tagged event log you
            can also stream to the backend when you want long-range continuity.
          </p>
        </div>
      </section>
    </main>
  </div>

  <!-- META KERNEL SCRIPT: VIEW ROUTER + MODEL ADAPTER -->
  <script>
    // ------- VIEW ROUTER -------
    (function initViewRouter() {
      const buttons = Array.from(
        document.querySelectorAll(".meta-nav-button")
      );
      const views = Array.from(document.querySelectorAll("[data-view]"));
      const statusLine = document.getElementById("kernel-status-line");

      function setActiveView(targetId) {
        views.forEach((v) => {
          if (v.id === targetId) {
            v.classList.remove("hidden");
          } else {
            v.classList.add("hidden");
          }
        });

        buttons.forEach((b) => {
          const t = b.getAttribute("data-target");
          if (t === targetId) {
            b.classList.add("active");
          } else {
            b.classList.remove("active");
          }
        });

        window.MetaKernel.activeView = targetId;

        if (statusLine) {
          statusLine.textContent =
            "Active view: " +
            targetId.replace("view-", "").toUpperCase() +
            " ¬∑ Kernel synced.";
        }

        // When switching to chat view, let the œÜ-field canvas refit
        if (targetId === "view-chat" && window.PHYLLO && typeof window.PHYLLO.fit === "function") {
          window.PHYLLO.fit();
        }

        // Log view change to MetaEngine if available
        if (window.MetaEngine && typeof window.MetaEngine.logEvent === "function") {
          window.MetaEngine.logEvent({
            actor: "engine",
            kind: "view_change",
            module: "meta_nav",
            kernel: "i99t",
            payload: { viewId: targetId }
          });
        }
      }

      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-target");
          if (!target) return;
          setActiveView(target);
        });
      });

      // Initial view
      setActiveView("view-momentit");
    })();

    // ------- HRAS DEFINITION PANEL -------
    (function initHRASDefinitions() {
      const DEFINITIONS = {
        RCE: {
          title: "Residual Content Engine (RCE)",
          content:
            "Builds topical authority and long-form assets that feed every other layer. Main metric: Lead Capture Rate (LCR)."
        },
        FIS: {
          title: "Federated Insight Stream (FIS)",
          content:
            "Merges external APIs & data into proprietary, high-leverage insights. Main metric: User Engagement Rate (UER)."
        },
        PLF: {
          title: "Perpetual Lead Funnel (PLF)",
          content:
            "Qualifies, profiles, and runs hyper-personalized outreach. Main metric: Revenue Per Outreach (RPO)."
        },
        DualInformationLaw: {
          title: "Dual Information Law of Variable Relativity",
          content:
            "Controller that scores tasks by (Value - Cost) and reassigns tokens to whatever is most profitable in the manifold of learning."
        },
        ManifoldOfLearning: {
          title: "Manifold of Learning",
          content:
            "The abstract state space HRAS explores. Dimensions: attention, signal, risk, and conversion. The kernel is always seeking a steeper slope."
        },
        Axioms: {
          title: "Core Axioms",
          content:
            "Information precedes capital; residual structure outlives effort; anything that can be templatized can be residualized."
        },
        ITPlus: {
          title: "IT+ (Information Theory Plus)",
          content:
            "Treats information as re-usable, recombinable matter. Once generated, it can be shaped into infinite outputs at near-zero marginal cost."
        },
        RPL: {
          title: "Reputation & Proof Layer (RPL)",
          content:
            "Monitors wins and synthesizes social proof, injecting it into PLF and RCE for compounding trust."
        },
        UIL: {
          title: "User Insight Layer (UIL)",
          content:
            "Low-friction feedback capture (‚Äúhelpful / confusing‚Äù). Feeds content style & focus adjustments."
        },
        EEL: {
          title: "Experimentation & Evolution Layer (EEL)",
          content:
            "Micro A/B tests on copy & offers. Uses simple metrics to continuously converge on higher conversion baselines."
        },
        ARL: {
          title: "Asset Recycling Layer (ARL)",
          content:
            "Turns every primary asset into derivative posts, emails, & hooks. One asset, many channels."
        },
        PML: {
          title: "Partnership Mesh Layer (PML)",
          content:
            "Finds and profiles synergistic partners; drafts win-win outreach to borrow their audience."
        },
        PLL: {
          title: "Product Ladder Layer (PLL)",
          content:
            "Defines and enforces Bronze ‚Üí Silver ‚Üí Gold tiers, using scarcity & value stacking to justify price jumps."
        },
        EngineCore: {
          title: "LLM / API ENGINE",
          content:
            "All heavy lifting goes here: content generation, classification, extraction. This is where Groq will live."
        }
      };

      const panelTitle = document.getElementById("panel-title");
      const panelContent = document.getElementById("panel-content");
      if (!panelTitle || !panelContent) return;

      const clickable = Array.from(
        document.querySelectorAll(
          "#view-hras .system-module, #view-hras .axiom-pill-chip, #EngineCore"
        )
      );

      clickable.forEach((el) => {
        el.addEventListener("click", () => {
          const id = el.id;
          const def = DEFINITIONS[id];
          clickable.forEach((c) => c.classList.remove("active-module"));
          el.classList.add("active-module");
          if (def) {
            panelTitle.textContent = def.title;
            panelContent.textContent = def.content;
          }
        });
      });
    })();

    // ------- SCM TAB SWITCHING -------
    (function initSCMTabs() {
      const tabs = Array.from(
        document.querySelectorAll("#view-scm .nav-tab")
      );
      const contents = Array.from(
        document.querySelectorAll("#view-scm .tab-content")
      );
      if (!tabs.length || !contents.length) return;

      function setTab(targetId) {
        tabs.forEach((t) => {
          t.classList.toggle(
            "active",
            t.getAttribute("data-tab") === targetId
          );
        });
        contents.forEach((c) => {
          c.classList.toggle("hidden", c.id !== targetId);
        });
      }

      tabs.forEach((t) => {
        t.addEventListener("click", () => {
          const id = t.getAttribute("data-tab");
          if (id) setTab(id);
        });
      });

      setTab("architecture");
    })();

    // ------- META KERNEL OBJECT -------
    const MetaKernel = {
      version: "3.1",
      activeView: "view-momentit",
      userId:
        crypto && crypto.randomUUID
          ? crypto.randomUUID()
          : "anon-" + Date.now(),

      /**
       * Core call wrapper for your LLM backend.
       * You plug Groq (or whatever) into the TODO block below.
       */
      async callModel(payload) {
        const body = {
          messages: [payload],
          meta: {
            view: this.activeView,
            userId: this.userId,
            kernelVersion: this.version
          }
        };

        // TODO: Plug your Groq endpoint & API key here.
        // Example shape (you will replace URL + headers with Groq specifics):
        //
        // return fetch("https://api.groq.com/openai/v1/chat/completions", {
        //   method: "POST",
        //   headers: {
        //     "Content-Type": "application/json",
        //     "Authorization": "Bearer YOUR_GROQ_API_KEY"
        //   },
        //   body: JSON.stringify({
        //     model: "groq/mixtral-or-whatever",
        //     messages: [
        //       { role: "system", content: "You are the i99t meta engine..." },
        //       body.messages[0]
        //     ]
        //   })
        // }).then(res => res.json());

        console.warn(
          "[MetaKernel] callModel invoked with payload but no Groq backend wired.",
          body
        );
        // Dummy echo for now so your UI has something to work with.
        return Promise.resolve({
          role: "assistant",
          content:
            "MetaKernel stub: I received your payload in view `" +
            this.activeView +
            "` and I'm ready for you to wire Groq."
        });
      }
    };

    // expose globally
    window.MetaKernel = MetaKernel;

    // ------- ATTACH POINTS FOR EXISTING MODULE SCRIPTS -------
    function attachMomentITScripts() {
      // This is where you can paste the original MomentIT
      // Firebase / Firestore / T-suite JS you already have.
      //
      // In that code, just make sure:
      // - You target #momentit-app instead of #app if it was hardcoded.
      // - You keep IDs like ping-banner, acknowledge-btn, event-log, etc.
    }

    function attachActuationLogScripts() {
      // Same idea: paste your full MFC / Actuation Log countdown
      // script here, wired to #countdown, #lock-time, #day-status,
      // and #log-area.
    }

    document.addEventListener("DOMContentLoaded", () => {
      attachMomentITScripts();
      attachActuationLogScripts();
    });
  </script>

  <!-- METAENGINE: EVENT SPINE / MEMORY -->
  <script>
    (function () {
      const STORAGE_KEY_EVENTS = "itplus_meta_events_v1";

      function uuid() {
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
          const r = Math.random() * 16 | 0;
          const v = c === "x" ? r : (r & 0x3 | 0x8);
          return v.toString(16);
        });
      }

      function nowMs() {
        return Date.now();
      }

      function dayBucket(ts) {
        const d = new Date(ts);
        const y = d.getFullYear();
        const m = (d.getMonth() + 1).toString().padStart(2, "0");
        const day = d.getDate().toString().padStart(2, "0");
        return y + "-" + m + "-" + day;
      }

      function copy(obj) {
        return obj == null ? obj : JSON.parse(JSON.stringify(obj));
      }

      function extractHashTags(text) {
        if (!text || typeof text !== "string") return [];
        const matches = text.match(/#([a-zA-Z0-9_\-]+)/g) || [];
        return matches.map(tag => tag.slice(1).toLowerCase());
      }

      const MetaEngine = {
        state: {
          events: [],
          currentThreadId: "thread:default",
          currentGoalId: null
        },

        loadEvents() {
          try {
            const raw = localStorage.getItem(STORAGE_KEY_EVENTS);
            if (!raw) return;
            const parsed = JSON.parse(raw);
            if (Array.isArray(parsed)) {
              this.state.events = parsed;
            }
          } catch (e) {
            console.warn("[MetaEngine] Event load error:", e);
          }
        },

        saveEvents() {
          try {
            localStorage.setItem(STORAGE_KEY_EVENTS, JSON.stringify(this.state.events));
          } catch (e) {
            console.warn("[MetaEngine] Event save error:", e);
          }
        },

        clearEvents() {
          this.state.events = [];
          try { localStorage.removeItem(STORAGE_KEY_EVENTS); } catch (e) {}
          console.info("[MetaEngine] All events cleared.");
        },

        setContext(ctx) {
          if (!ctx) return;
          if (ctx.threadId) this.state.currentThreadId = ctx.threadId;
          if (ctx.goalId) this.state.currentGoalId = ctx.goalId;
        },

        logEvent(raw) {
          const ts = nowMs();
          const day = dayBucket(ts);
          const id = raw.id || uuid();
          const actor = raw.actor || "engine";
          const kind = raw.kind || "message";
          const threadId = raw.thread_id || this.state.currentThreadId || "thread:default";
          const goalId = raw.goal_id || this.state.currentGoalId || null;

          const payload = raw.payload || {};
          const text = raw.text || payload.text || "";
          const explicitTags = (raw.tags || []).concat(extractHashTags(text));

          const structuralTags = [];
          structuralTags.push("session:" + day);
          if (raw.module) structuralTags.push("module:" + raw.module);
          if (raw.kernel) structuralTags.push("kernel:" + raw.kernel);
          if (goalId) structuralTags.push("goal:" + goalId);
          structuralTags.push("thread:" + threadId);
          structuralTags.push("kind:" + kind);

          const tags = Array.from(new Set(
            explicitTags.map(t => t.toLowerCase()).concat(structuralTags)
          ));

          const event = {
            id,
            ts,
            actor,
            kind,
            thread_id: threadId,
            goal_id: goalId,
            parent_id: raw.parent_id || null,
            tags,
            payload
          };

          this.state.events.push(event);
          this.saveEvents();

          return event;
        },

        queryEvents(filter) {
          const events = this.state.events || [];
          if (!filter) return copy(events);

          return events.filter(ev => {
            if (filter.threadId && ev.thread_id !== filter.threadId) return false;
            if (filter.goalId && ev.goal_id !== filter.goalId) return false;
            if (filter.tag) {
              if (!ev.tags || !ev.tags.includes(filter.tag)) return false;
            }
            if (filter.kind && ev.kind !== filter.kind) return false;
            return true;
          }).map(copy);
        }
      };

      MetaEngine.loadEvents();
      window.MetaEngine = MetaEngine;
    })();
  </script>

  <!-- œÜ-FIELD PHYLLO BACKGROUND + CHAT USING METAENGINE MEMORY -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      /* œÜ‚ÄìFIELD BG (Phyllo swirl scoped to phi-console-root) */
      (()=>{
        const T=Math.PI*2,
              canvas=document.getElementById('phi-bg'),
              root=document.getElementById('phi-console-root');
        if(!canvas || !root) return;
        const x=canvas.getContext('2d');
        let W=0,H=0,D=1,t=0,run=1;
        const s={CS:.987,TSI:.10,novelty:.20,presence:.82};

        function fit(){
          const rect=root.getBoundingClientRect();
          W = rect.width || root.offsetWidth || 600;
          H = rect.height || root.offsetHeight || 420;
          D=Math.max(1,Math.min(2,window.devicePixelRatio||1));
          canvas.width=Math.round(W*D);
          canvas.height=Math.round(H*D);
          canvas.style.width=W+'px';
          canvas.style.height=H+'px';
          x.setTransform(D,0,0,D,0,0);
        }
        addEventListener('resize',fit,{passive:!0});
        fit();

        const C=(v,a,b)=>Math.max(a,Math.min(b,v)),
              L=(a,b,u)=>a+(b-a)*u,
              E=u=>u<.5?2*u*u:1-Math.pow(-2*u+2,2)/2,
              GA=CS=>{
                const g=Math.PI*(3-Math.sqrt(5)),d=(1-CS)*.02;
                return g*(1+d*Math.sin(t*.25));
              },
              R=(seed=1234567)=>{
                let s=seed>>>0;
                return()=>((s=(s*1664525+1013904223)>>>0)/4294967296);
              };

        function draw(){
          const g=x.createLinearGradient(0,0,0,H);
          g.addColorStop(0,'#05080d');
          g.addColorStop(1,'#0a0f16');
          x.fillStyle=g;
          x.fillRect(0,0,W,H);

          const cx=W*.5,cy=H*.52,maxR=Math.min(W,H)*.49,
                CS=C(s.CS,.7,1),TSI=C(s.TSI,0,1),
                nv=C(s.novelty,0,1),pr=C(s.presence,0,1);

          const N=Math.floor(L(600,3200,E(pr))),
                ang=GA(CS),base=L(2.2,6,CS),jit=L(0,1,TSI),
                spin=nv*.8,breath=1+.045*Math.sin(t*.5),
                rand=R(123456789^(N<<1));

          x.save();
          x.translate(cx,cy);

          for(let i=0;i<N;i++){
            const a=i*ang+t*spin,r=Math.sqrt(i)*base*breath;
            let px=Math.cos(a)*r,py=Math.sin(a)*r;

            px+=(rand()-.5)*jit*(.6+.6*Math.sin(i*.017+t*.3));
            py+=(rand()-.5)*jit*(.6+.6*Math.cos(i*.013-t*.25));

            const scale=maxR/(Math.sqrt(N)*5.8),
                  x0=px*scale,y0=py*scale,
                  sz=L(1.2,2.8,CS)*(1-.5*TSI),
                  p=i/N,
                  h=(210+90*p+120*nv+26*Math.sin(t*.28))%360,
                  sa=Math.round(L(42,68,CS)),
                  lu=Math.round(L(34,62,1-TSI));

            x.fillStyle=`hsl(${h} ${sa}% ${lu}%)`;
            x.beginPath();
            x.arc(x0,y0,sz,0,T);
            x.fill();
          }

          x.restore();
        }

        let last=performance.now();
        function loop(now){
          const dt=(now-last)/1e3;last=now;
          if(run)t+=dt;
          draw();
          requestAnimationFrame(loop);
        }
        requestAnimationFrame(loop);

        window.PHYLLO={
          update(m={}){
            if('CS'in m)s.CS=m.CS;
            if('TSI'in m)s.TSI=m.TSI;
            if('novelty'in m)s.novelty=m.novelty;
            if('presence'in m)s.presence=m.presence;
            if('running'in m)run=!!m.running;
          },
          fit
        };
      })();

      /* Chat + Filing, wired into MetaEngine memory */
      const $=id=>document.getElementById(id),
            stream=$('stream'),
            form=$('form'),
            input=$('input'),
            fileBtn=$('file-btn'),
            filesBtn=$('files-btn'),
            filesModal=$('files-modal'),
            modalCloseBtn=$('modal-close-btn'),
            modalList=$('modal-list'),
            fileCount=$('file-count');

      function linkify(s){
        return (s||'')
          .replace(/[&<>]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]))
          .replace(/\bhttps?:\/\/[^\s)]+/g,u=>`<a href="${u}" target="_blank" rel="noopener">${u}</a>`);
      }

      function addMsg(role,html){
        const id=Date.now().toString(36)+Math.random().toString(36).slice(2,5),
              row=document.createElement('div');
        row.className='row '+(role==='user'?'user':'bot')+' emerge';
        row.draggable=!0;
        row.dataset.messageId=id;

        const b=document.createElement('div');
        b.className='bubble '+(role==='user'?'user':'bot');
        b.innerHTML=linkify(html);

        const meta=document.createElement('div');
        meta.className='meta';
        meta.textContent=new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});

        row.appendChild(b);
        row.appendChild(meta);
        stream.appendChild(row);

        setTimeout(()=>row.classList.add('active'),10);
        row.addEventListener('dragstart',onDragStart);
        stream.scrollTop=stream.scrollHeight;

        // Log to MetaEngine
        if (window.MetaEngine && typeof MetaEngine.logEvent === "function") {
          MetaEngine.logEvent({
            actor: role === 'user' ? 'user' : 'assistant',
            kind: 'message',
            module: 'phi_console',
            kernel: 'i99t',
            payload: {
              text: html,
              view: window.MetaKernel ? MetaKernel.activeView : null,
              message_id: id
            }
          });
        }
      }

      function getFiledEvents(){
        if (!window.MetaEngine || typeof MetaEngine.queryEvents !== "function") return [];
        // "filed" tag is explicit; also structural tag "kind:file"
        const events = MetaEngine.queryEvents({ tag: 'filed' });
        // Sort newest first for display convenience
        return events.sort((a,b)=>b.ts-a.ts);
      }

      function logFileEvent(text,id){
        if (!window.MetaEngine || typeof MetaEngine.logEvent !== "function") return null;
        return MetaEngine.logEvent({
          actor: 'user',
          kind: 'file',
          module: 'phi_console',
          kernel: 'i99t',
          tags: ['filed'],
          payload: {
            text,
            source_message_id: id
          }
        });
      }

      function onDragStart(e){
        const text=e.currentTarget.querySelector('.bubble').textContent;
        e.dataTransfer.setData('text/plain',text);
        e.dataTransfer.setData('message/id',e.currentTarget.dataset.messageId);
        e.dataTransfer.effectAllowed='move';
        fileBtn.style.color='var(--accent)';
        fileBtn.style.transform='scale(1.2)';
      }

      fileBtn.addEventListener('dragover',e=>{
        e.preventDefault();
        e.dataTransfer.dropEffect='move';
        fileBtn.style.opacity=.8;
      });

      fileBtn.addEventListener('dragleave',()=>{
        fileBtn.style.opacity=1;
      });

      fileBtn.addEventListener('drop',e=>{
        e.preventDefault();
        fileBtn.style.color='#d9e1ea';
        fileBtn.style.transform='scale(1)';
        fileBtn.style.opacity=1;

        const text=e.dataTransfer.getData('text/plain'),
              id=e.dataTransfer.getData('message/id');

        logFileEvent(text,id);

        addMsg(
          'bot',
          'Filing complete: message has been tagged and filed.\n'+
          'A new MetaEngine event with tag "filed" was created for:\n'+
          text.substring(0,60).trim()+'...'
        );

        const row=document.querySelector('[data-message-id="'+id+'"]');
        if(row)row.remove();
      });

      addEventListener('dragend',()=>{
        fileBtn.style.color='#d9e1ea';
        fileBtn.style.transform='scale(1)';
        fileBtn.style.opacity=1;
      });

      function openFiles(){
        modalList.innerHTML='';
        const filedEvents=getFiledEvents();
        fileCount.textContent=filedEvents.length;

        if(!filedEvents.length){
          modalList.innerHTML=
            '<div style="text-align:center;padding:20px;color:#9aa7b6;">'+
            'No items filed yet. Drag a message onto the üìÅ icon to start filing.'+
            '</div>';
        }else{
          filedEvents.forEach(ev=>{
            const d=document.createElement('div');
            d.className='file-item';
            const when = new Date(ev.ts).toLocaleString('en-US',{hour:'numeric',minute:'2-digit',month:'short',day:'numeric'});
            const txt = (ev.payload && ev.payload.text) || '';
            d.innerHTML=linkify(txt)+'<span class="file-item-time">'+when+'</span>';
            modalList.appendChild(d);
          });

          addMsg('bot','Files opened: '+filedEvents.length+' filed item(s) in MetaEngine memory.\nThese are events tagged "filed".');
        }

        filesModal.classList.add('open');
        filesModal.setAttribute('aria-hidden','false');
      }

      filesBtn.addEventListener('click',openFiles);

      modalCloseBtn.addEventListener('click',()=>{
        filesModal.classList.remove('open');
        filesModal.setAttribute('aria-hidden','true');
      });

      filesModal.addEventListener('click',e=>{
        if(e.target.id==='files-modal'){
          filesModal.classList.remove('open');
          filesModal.setAttribute('aria-hidden','true');
        }
      });

      /* ========= LLM CHAT HANDLER (Groq-backed via /chat) ========= */

      async function handleChatWithLLM(userText){
        try{
          const res=await fetch('/chat',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({message:userText})
          });
          const data=await res.json();
          if(data && data.reply){
            addMsg('bot',data.reply);
          }else{
            addMsg('bot',"No reply from backend /chat. Check your server or API wiring.");
          }
        }catch(e){
          console.error('Chat backend error:', e);
          addMsg('bot',"Error talking to model backend. Make sure /chat exists and your API key is set on the server.");
        }
      }

      /* ========= Command + routing layer ========= */

      function processInput(txt){
        const t=txt.trim().toLowerCase();

        // Help command
        if(t==='help it'){
          addMsg(
            'bot',
            "Help ¬∑ œÜ-Field Console\n\n"+
            "- Just type normally to chat with the model (via your /chat backend).\n"+
            "- help it  ‚Äî show this help.\n\n"+
            "Filing:\n"+
            "- Drag any message onto the üìÅ icon to file it (stored in MetaEngine memory).\n"+
            "- Click the cabinet icon (üóÑÔ∏è) to browse filed items."
          );
          return;
        }

        // Everything else goes to the model
        handleChatWithLLM(txt);
      }

      /* Wire form submission to processInput */
      form.addEventListener('submit',e=>{
        e.preventDefault();
        const txt=input.value.trim();
        if(!txt)return;
        addMsg('user',txt);
        input.value='';
        processInput(txt);
      });

      /* Initial bot line */
      addMsg(
        'bot',
        "Welcome to the œÜ-Field console.\n\n"+
        "- Type anything to chat with the model (wired to /chat).\n"+
        "- Type \"help it\" for a quick guide.\n\n"+
        "Drag any message onto the folder icon to file it; click the cabinet icon to browse.\n"+
        "All of this is mirrored into MetaEngine events for continuity and tagging."
      );
    });
  </script>
</body>
</html>
